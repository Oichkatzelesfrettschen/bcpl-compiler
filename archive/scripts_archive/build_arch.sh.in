#!/bin/bash
# Architecture-specific build script for @TARGET_ARCH@
# Generated by CMake

set -e

BUILD_DIR="build-@TARGET_ARCH@"
TARGET_ARCH="@TARGET_ARCH@"
CMAKE_ARGS="@CMAKE_ARGS@"

echo "Building BCPL Compiler for ${TARGET_ARCH}..."

# Create build directory
mkdir -p "${BUILD_DIR}"
cd "${BUILD_DIR}"

# Configure with architecture-specific settings
cmake -DTARGET_ARCH="${TARGET_ARCH}" ${CMAKE_ARGS} ..

# Build
make -j$(nproc 2>/dev/null || echo 4)

echo "Build complete for ${TARGET_ARCH}"
echo "Binaries located in ${BUILD_DIR}/src/"
echo "  - cg_${TARGET_ARCH}"
echo "  - op_${TARGET_ARCH}"
echo "  - st_${TARGET_ARCH}"
if [ -f "src/llcg_${TARGET_ARCH}" ]; then
    echo "  - llcg_${TARGET_ARCH}"
fi
